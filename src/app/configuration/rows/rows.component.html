<div class="p-8 flex flex-col flex-wrap h-full w-ful justify-between">


    <div class="flex flex-col flex-wrap gap-y-8">

        <div class="flex flex-col flex-wrap gap-y-2">
            <h1 class="font-bold text-lg">FILTERS</h1>
            <div class="flex flex-col md:flex-row justify-between">
                <div>
                    Here you can filter out some rows of your data
                    <mat-icon color="primary"
                        matTooltip="Decide your own criterias to filter your excel file. Only rows that matches all criterias will be displayed, please pay attention to insert the correct type. Regex are JAVA ones. If cannot cast to Number, that row will be ignored">
                        help</mat-icon>
                </div>
                <button mat-raised-button color="primary" (click)="addCriteria()">ADD FILTER</button>
            </div>
        </div>

        <div *ngIf="this.config.rowCriteria!.length > 0">

            <div class="max-h-[350px] overflow-y-auto p-[1px]">
                <table mat-table [dataSource]="this.config.rowCriteria!"
                    class="mat-elevation-z4 h-full w-full px-2 text-center">

                    <ng-container matColumnDef="Column">
                        <th mat-header-cell *matHeaderCellDef>Col Name</th>
                        <td mat-cell *matCellDef="let criteria index as i">
                            <div class="pt-[10px] flex flex-row items-center">
                                <span class="visible md:hidden basis-1/5 relative bottom-1">Col Name: </span>
                                <ng-select [items]="this.config.columns!" appearance="outline" [clearable]="false"
                                    class="w-full" appendTo="body" class="relative" dropdownPosition="auto"
                                    [virtualScroll]="true" [(ngModel)]="this.config.rowCriteria![i].columnName">
                                </ng-select>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Type">
                        <th mat-header-cell *matHeaderCellDef>Type</th>
                        <td mat-cell *matCellDef="let criteria; index as i">
                            <div class="flex flex-row items-center">
                                <span class="visible md:hidden basis-1/5">Type: </span>
                                <mat-form-field appearance="outline" class="pt-4">
                                    <mat-select [(value)]="this.config.rowCriteria![i].type">
                                        <mat-option value="String">String</mat-option>
                                        <mat-option value="Number">Number</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Op">
                        <th mat-header-cell *matHeaderCellDef>Op</th>
                        <td mat-cell *matCellDef="let criteria; index as i">
                            <div class="flex flex-row items-center">
                                <span class="visible md:hidden basis-1/5">Op: </span>
                                <mat-form-field appearance="outline" class="pt-4">
                                    <mat-select [(value)]="this.config.rowCriteria![i].op">
                                        <mat-option value=">">></mat-option>
                                        <mat-option value="&lt;">&lt;</mat-option>
                                        <mat-option value="==">==</mat-option>
                                        <mat-option value="!=">!=</mat-option>
                                        <mat-option *ngIf="this.config.rowCriteria![i]?.type==='String'" value="Regex">
                                            Regex</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Value">
                        <th mat-header-cell *matHeaderCellDef>Value</th>
                        <td mat-cell *matCellDef="let criteria; index as i">
                            <div class="flex flex-row items-center">
                                <span class="visible md:hidden basis-1/5">Value: </span>
                                <mat-form-field appearance="outline" class="pt-4">
                                    <input matInput [(ngModel)]="this.config.rowCriteria![i].value">
                                </mat-form-field>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Action">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let criteria; index as i">
                            <div class="hidden md:block">
                                <button mat-mini-fab (click)="removeCriteria(i)">
                                    <mat-icon color="warn">delete</mat-icon>
                                </button>
                            </div>
                            <div class="flex md:hidden flex-row justify-center">
                                <button mat-raised-button color="accent" (click)="removeCriteria(i)" class="w-full">
                                    <mat-icon color="warn">delete</mat-icon>
                                </button>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="['Column','Type', 'Op','Value', 'Action']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['Column','Type','Op','Value', 'Action'];"></tr>
                </table>
            </div>
        </div>

        <mat-divider class="w-full" *ngIf="this.config.view === 'PIVOT'"></mat-divider>

        <div class="flex flex-col flex-wrap gap-y-2" *ngIf="this.config.view === 'PIVOT'">
            <h1 class="font-bold text-lg">AGGREGATION FUNCTIONS</h1>
            <div class="flex flex-col md:flex-row justify-between">
                <div>
                    Here you can add rows based on aggregation functions (only numbers)
                    <mat-icon color="primary"
                        matTooltip="Currently you are allowed to block a max of 1 col per row built with this aggregation framework builder, and the column must be of type Number. Note in order to see something in the final table, you have to at least build one aggregation row.">
                        help</mat-icon>
                </div>
                <button mat-raised-button color="primary" (click)="addRowAggr()">ADD AGGREGATION ROW</button>
            </div>
        </div>

        <div *ngIf="this.config.aggregationRows!.length > 0">

            <div class="max-h-[350px] overflow-y-auto p-[1px]">
                <table mat-table [dataSource]="this.config.aggregationRows!"
                    class="mat-elevation-z4 h-full w-full px-2 text-center">

                    <ng-container matColumnDef="Blocked Column">
                        <th mat-header-cell *matHeaderCellDef>Blocked Column</th>
                        <td mat-cell *matCellDef="let col index as i">
                            <div class="pt-[10px] flex flex-row items-center">
                                <span class="visible md:hidden basis-1/5 relative bottom-1">Blocked Column: </span>
                                <mat-form-field appearance="outline" class="pt-4">
                                    <mat-select [(ngModel)]="this.config.aggregationRows![i].blockedCol">
                                        <mat-option *ngFor="let col of this.config.columns" [value]="col">{{col}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Target Column">
                        <th mat-header-cell *matHeaderCellDef>Target Column</th>
                        <td mat-cell *matCellDef="let col index as i">
                            <div class="pt-[10px] flex flex-row items-center">
                                <span class="visible md:hidden basis-1/5 relative bottom-1">Target Column: </span>
                                <mat-form-field appearance="outline" class="pt-4">
                                    <mat-select [(ngModel)]="this.config.aggregationRows![i].targetCol">
                                        <mat-option *ngFor="let col of this.config.columns" [value]="col">{{col}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Aggregation Op">
                        <th mat-header-cell *matHeaderCellDef>Aggregation Op</th>
                        <td mat-cell *matCellDef="let col; index as i">
                            <div class="flex flex-row items-center">
                                <span class="visible md:hidden basis-1/5">Aggregation Op: </span>
                                <mat-form-field appearance="outline" class="pt-4">
                                    <mat-select [(ngModel)]="this.config.aggregationRows![i].op">
                                        <mat-option value="Sum">Sum</mat-option>
                                        <mat-option value="Min">Min</mat-option>
                                        <mat-option value="Max">Max</mat-option>
                                        <mat-option value="Mean">Mean</mat-option>
                                        <mat-option value="Product">Product</mat-option>
                                        <mat-option value="Std Deviation">Std Deviation</mat-option>
                                        <mat-option value="Std Variance">Std Variance</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="Action">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let col; index as i">
                            <div class="hidden md:block">
                                <button mat-mini-fab (click)="removeRowAggr(i)">
                                    <mat-icon color="warn">delete</mat-icon>
                                </button>
                            </div>
                            <div class="flex md:hidden flex-row justify-center">
                                <button mat-raised-button color="accent" (click)="removeRowAggr(i)" class="w-full">
                                    <mat-icon color="warn">delete</mat-icon>
                                </button>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="['Blocked Column','Target Column','Aggregation Op', 'Action']">
                    </tr>
                    <tr mat-row
                        *matRowDef="let row; columns: ['Blocked Column','Target Column', 'Aggregation Op', 'Action'];">
                    </tr>
                </table>
            </div>
        </div>

        <mat-divider class="w-full"></mat-divider>

        <div class="flex flex-col flex-wrap gap-y-2" *ngIf="this.config.view !== 'PIVOT'">
            <h1 class="font-bold text-lg">SORTING</h1>

            <div class="flex flex-col md:flex-row justify-between">
                <div>
                    Choose order of columns you want to sort by
                    <mat-icon color="primary"
                        matTooltip="Note, if casting to Number fails, that row will be ignored during sorting process.">
                        help</mat-icon>
                </div>
                <button mat-raised-button (click)="addSort()" color="primary">ADD SORTING LEVEL</button>
            </div>

        </div>
        <div cdkDropList class="example-list" (cdkDropListDropped)="drop($event)"
            *ngIf="this.config.sortByColumns!.length > 0">
            <div class="example-box items-center gap-1 md:gap-0" *ngFor="let col of config.sortByColumns; index as i"
                cdkDrag>
                <div class="basis-full md:basis-[30%]">
                    <mat-form-field appearance="outline">
                        <mat-label>Column Name</mat-label>
                        <mat-select [(ngModel)]="this.config.sortByColumns![i].name">
                            <mat-option *ngFor="let col of this.config.columns" [value]="col">
                                {{col}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="basis-full md:basis-[30%]">
                    <mat-form-field appearance="outline">
                        <mat-label>Column Type</mat-label>
                        <mat-select [(ngModel)]="this.config.sortByColumns![i].type">
                            <mat-option value="String">String</mat-option>
                            <mat-option value="Number">Number</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="basis-full md:basis-[30%]">
                    <mat-form-field appearance="outline">
                        <mat-label>Order Type</mat-label>
                        <mat-select [(ngModel)]="this.config.sortByColumns![i].order">
                            <mat-option [value]="1">Ascending</mat-option>
                            <mat-option [value]="-1">Descending</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="basis-full md:basis-auto flex flex-row justify-center">
                    <div class="hidden md:block">
                        <button mat-mini-fab (click)="removeSort(i)">
                            <mat-icon color="warn">delete</mat-icon>
                        </button>
                    </div>
                    <div class="flex md:hidden flex-row justify-center">
                        <button mat-raised-button color="accent" (click)="removeSort(i)" class="w-full">
                            <mat-icon color="warn">delete</mat-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="flex flex-row justify-end pt-4">
        <button mat-raised-button color="accent" (click)="indexTo.emit(4)">NEXT</button>
    </div>

</div>